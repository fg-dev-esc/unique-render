<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PayPal API - UniqueMotors</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%23000000'/%3E%3Cpath d='M18 22l-8 10 8 10' stroke='%23ffffff' stroke-width='4.5' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3Cpath d='M46 22l8 10-8 10' stroke='%23ffffff' stroke-width='4.5' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3Cpath d='M38 18l-12 28' stroke='%23ffffff' stroke-width='4' stroke-linecap='round'/%3E%3Cline x1='12' y1='12' x2='18' y2='18' stroke='%23ffffff' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='52' y1='12' x2='46' y2='18' stroke='%23ffffff' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='12' y1='52' x2='18' y2='46' stroke='%23ffffff' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='52' y1='52' x2='46' y2='46' stroke='%23ffffff' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle cx='32' cy='32' r='24' stroke='%23ffffff' stroke-width='1.5' fill='none' opacity='0.15'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@11.0.8/dist/framer-motion.min.js"></script>
  <style>
    :root {
      --color-blue: #1447e6;
    }

    * {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }
    body {
      background-color: #000000;
    }
    .method-badge {
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.25rem 0.75rem;
      border-radius: 0.375rem;
      letter-spacing: 0.05em;
    }
    .method-post {
      background-color: #10b981;
      color: white;
    }
    .method-get {
      background-color: #3b82f6;
      color: white;
    }
    .code-block {
      background-color: #0f0f0f;
      border: 1px solid #27272a;
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      color: #e4e4e7;
      line-height: 1.5;
    }
    .endpoint-card {
      background-color: #09090b;
      border: 1px solid #27272a;
      border-radius: 0.75rem;
      transition: all 0.3s ease;
    }
    .endpoint-card:hover {
      border-color: var(--color-blue);
      box-shadow: 0 10px 25px rgba(20, 71, 230, 0.1);
    }
    .tab-button {
      padding: 0.5rem 1rem;
      border-bottom: 2px solid transparent;
      color: #a1a1a1;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
      font-weight: 500;
    }
    .tab-button.active {
      border-bottom-color: var(--color-blue);
      color: #ffffff;
    }

    .btn-blue {
      background-color: var(--color-blue);
    }

    .btn-blue:hover {
      background-color: #0e3bb3;
    }

    .text-blue-accent {
      color: var(--color-blue);
    }
    .tab-button:hover {
      color: #ffffff;
    }
    svg {
      display: inline;
    }

    /* Modal Styles (Shadcn-inspired) */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeIn 0.2s ease-in-out;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background-color: #09090b;
      border: 1px solid #27272a;
      border-radius: 0.75rem;
      padding: 1.5rem;
      max-width: 32rem;
      width: 90%;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-1rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-input {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: #000000;
      border: 1px solid #27272a;
      border-radius: 0.5rem;
      color: #ffffff;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .modal-input:focus {
      outline: none;
      border-color: var(--color-blue);
      box-shadow: 0 0 0 3px rgba(20, 71, 230, 0.1);
    }

    .modal-input::placeholder {
      color: #52525b;
    }

    /* Dock Styles */
    .dock-container {
      position: absolute;
      top: 50%;
      right: 2rem;
      transform: translateY(-50%);
      z-index: 100;
    }

    .dock {
      display: flex;
      height: 58px;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 1rem;
      border: 1px solid rgba(39, 39, 42, 0.5);
      padding: 0.5rem;
      background: rgba(9, 9, 11, 0.8);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .dock-icon {
      display: flex;
      aspect-ratio: 1;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      transition: background-color 0.2s;
      position: relative;
      padding: 0.4rem;
    }

    .dock-icon:hover {
      background-color: rgba(39, 39, 42, 0.5);
    }

    .dock-icon.active {
      background-color: var(--color-blue);
    }

    .dock-icon-label {
      position: absolute;
      top: calc(100% + 0.5rem);
      left: 50%;
      transform: translateX(-50%) scale(0.8);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s, transform 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .dock-icon:hover .dock-icon-label {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }
  </style>
</head>
<body class="min-h-screen bg-black text-white">
  <div class="flex h-screen">
    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto" id="mainContent">
      <!-- Header -->
      <div class="border-b border-zinc-800 bg-zinc-950 sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-6 py-6" style="position: relative;">
          <h1 class="text-3xl font-bold mb-2">PayPal Backend API</h1>
          <p class="text-zinc-400 text-sm">
            Documentación para procesamiento de pagos
          </p>

          <!-- Dock Navigation -->
          <div class="dock-container">
            <div class="dock" id="dock">
              <div class="dock-icon" data-section="top" onclick="scrollToTop()">
                <span class="dock-icon-label">URL</span>
                <i data-lucide="package" class="w-5 h-5"></i>
              </div>
              <div class="dock-icon" data-section="create-order" onclick="scrollToSection('create-order')">
                <span class="dock-icon-label">Crear Orden</span>
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
              </div>
              <div class="dock-icon" data-section="capture-order" onclick="scrollToSection('capture-order')">
                <span class="dock-icon-label">Capturar Orden</span>
                <i data-lucide="check-circle" class="w-5 h-5"></i>
              </div>
              <div class="dock-icon" data-section="webhook" onclick="scrollToSection('webhook')">
                <span class="dock-icon-label">Webhook</span>
                <i data-lucide="webhook" class="w-5 h-5"></i>
              </div>
              <div class="dock-icon" data-section="health" onclick="scrollToSection('health')">
                <span class="dock-icon-label">Health Check</span>
                <i data-lucide="heart-handshake" class="w-5 h-5"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="max-w-6xl mx-auto p-6 space-y-6">
        <!-- Base URL Info -->
        <div class="endpoint-card p-6" id="baseUrlCard" style="perspective: 1000px;">
          <div class="text-sm text-zinc-400 mb-2">BASE URL</div>
          <div class="flex items-center gap-3">
            <code class="text-zinc-300 font-mono text-sm">https://unique-motors.onrender.com</code>
            <button onclick="copyToClipboard('https://unique-motors.onrender.com')" class="text-zinc-400 hover:text-white transition-colors" title="Copy URL">
              <i data-lucide="copy" class="w-4 h-4"></i>
            </button>
          </div>
        </div>

        <!-- Endpoint 1: Create Order -->
        <div id="create-order" class="endpoint-card overflow-hidden">
          <div class="bg-zinc-900 border-b border-zinc-800 p-6">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center gap-3">
                <span class="method-badge method-post">POST</span>
                <code class="text-zinc-300 font-mono">/api/orders</code>
              </div>
            </div>
            <p class="text-zinc-400 text-sm">Crear una nueva orden de pago</p>
          </div>

          <div class="p-6 space-y-6">
            <!-- Description -->
            <div>
              <h3 class="text-sm font-semibold mb-3 text-zinc-300">Descripción</h3>
              <p class="text-zinc-400 text-sm leading-relaxed">
                Crea una nueva orden de pago en PayPal. La orden puede ser un depósito de garantía o un pago de adjudicación. El sistema almacena automáticamente los detalles en Supabase.
              </p>
            </div>

            <!-- Tabs -->
            <div class="border-b border-zinc-800">
              <div class="flex gap-4">
                <button class="tab-button active" onclick="switchTab(event, 'req1')">Request</button>
                <button class="tab-button" onclick="switchTab(event, 'res1')">Response</button>
              </div>
            </div>

            <!-- Request Tab -->
            <div id="req1" class="space-y-4">
              <div>
                <h4 class="text-sm font-semibold text-zinc-300 mb-3">Body Parameters</h4>
                <div class="space-y-3">
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-4">
                    <div class="font-mono text-sm text-zinc-300 mb-1">amount</div>
                    <div class="text-xs text-zinc-500 mb-2">number (required)</div>
                    <p class="text-xs text-zinc-400">Monto a cobrar (ej: 1500)</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-4">
                    <div class="font-mono text-sm text-zinc-300 mb-1">currency</div>
                    <div class="text-xs text-zinc-500 mb-2">string (default: MXN)</div>
                    <p class="text-xs text-zinc-400">Código de moneda (MXN, USD, etc.)</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-4">
                    <div class="font-mono text-sm text-zinc-300 mb-1">paymentContext</div>
                    <div class="text-xs text-zinc-500 mb-2">string (required)</div>
                    <p class="text-xs text-zinc-400">"guarantee" o "adjudicacion"</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-4">
                    <div class="font-mono text-sm text-zinc-300 mb-1">torreID</div>
                    <div class="text-xs text-zinc-500 mb-2">string (optional)</div>
                    <p class="text-xs text-zinc-400">Identificador de torre</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-4">
                    <div class="font-mono text-sm text-zinc-300 mb-1">articuloNombre</div>
                    <div class="text-xs text-zinc-500 mb-2">string (optional)</div>
                    <p class="text-xs text-zinc-400">Nombre del artículo</p>
                  </div>
                </div>
              </div>

              <div>
                <h4 class="text-sm font-semibold text-zinc-300 mb-3">Ejemplo</h4>
                <div class="code-block">
<code>{
  "amount": 1500,
  "currency": "MXN",
  "paymentContext": "guarantee"
}</code>
                </div>
              </div>
            </div>

            <!-- Response Tab -->
            <div id="res1" class="space-y-4 hidden">
              <div>
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-zinc-300">Response</h4>
                  <div class="flex gap-2">
                    <button onclick="abrirPayPal()" id="abrirPayPalBtn" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2 hidden">
                      <i data-lucide="external-link" class="w-4 h-4"></i>
                      Abrir PayPal
                    </button>
                    <button onclick="copiarSoloID()" id="copiarIDBtn" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2 hidden">
                      <i data-lucide="copy" class="w-4 h-4"></i>
                      Copiar ID
                    </button>
                    <!-- <button onclick="copiarRespuesta('createOrderResponse')" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                      <i data-lucide="copy" class="w-4 h-4"></i>
                      Copiar Todo
                    </button> -->
                  </div>
                </div>
                <div id="createOrderResponse" class="code-block text-xs overflow-auto max-h-96">
                  <code id="createOrderResponseCode" class="text-green-400">Aquí aparecerá el response...</code>
                </div>
              </div>
            </div>

            <button onclick="testCreateOrder()" class="w-full btn-blue text-white font-medium py-2 px-4 rounded transition-colors text-sm flex items-center justify-center gap-2">
              <i data-lucide="play" class="w-4 h-4"></i>
              Try it out
            </button>
          </div>
        </div>

        <!-- Endpoint 2: Capture Order -->
        <div id="capture-order" class="endpoint-card overflow-hidden">
          <div class="bg-zinc-900 border-b border-zinc-800 p-6">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center gap-3">
                <span class="method-badge method-post">POST</span>
                <code class="text-zinc-300 font-mono">/api/orders/:orderID/capture</code>
              </div>
            </div>
            <p class="text-zinc-400 text-sm">Capturar y completar una orden de pago</p>
          </div>

          <div class="p-6 space-y-6">
            <div>
              <h3 class="text-sm font-semibold mb-3 text-zinc-300">Descripción</h3>
              <p class="text-zinc-400 text-sm leading-relaxed">
                Captura una orden aprobada y completa la transacción de pago. La orden debe estar en estado APPROVED.
              </p>
            </div>

            <div class="border-b border-zinc-800">
              <div class="flex gap-4">
                <button class="tab-button active" onclick="switchTab(event, 'req2')">Request</button>
                <button class="tab-button" onclick="switchTab(event, 'res2')">Response</button>
              </div>
            </div>

            <div id="req2" class="space-y-4">
              <div>
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-zinc-300">Order ID</h4>
                  <button onclick="pegarOrderID()" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                    <i data-lucide="clipboard-paste" class="w-4 h-4"></i>
                    Pegar
                  </button>
                </div>
                <input
                  type="text"
                  id="captureOrderID"
                  placeholder="Ingresa el Order ID (ej: 5O190127H6828335L)"
                  class="w-full px-4 py-2 bg-black border border-zinc-700 rounded-md text-white placeholder-zinc-500 focus:outline-none focus:ring-2 transition-all"
                  style="--tw-ring-color: var(--color-blue);"
                />
                <p class="text-xs text-zinc-500 mt-2">Copia el ID que obtuviste del endpoint /api/orders</p>
              </div>

              <div>
                <h4 class="text-sm font-semibold text-zinc-300 mb-3">Ejemplo de Uso</h4>
                <div class="code-block">
<code>POST /api/orders/5O190127H6828335L/capture
Content-Type: application/json

{}</code>
                </div>
              </div>
            </div>

            <div id="res2" class="space-y-4 hidden">
              <div>
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-zinc-300">Response</h4>
                  <button onclick="copiarRespuesta('captureResponse')" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                    <i data-lucide="copy" class="w-4 h-4"></i>
                    Copiar
                  </button>
                </div>
                <div id="captureResponse" class="code-block text-xs overflow-auto max-h-96">
                  <code id="captureResponseCode" class="text-green-400">Aquí aparecerá el response...</code>
                </div>
              </div>
            </div>

            <button onclick="captureOrder()" class="w-full btn-blue text-white font-medium py-2 px-4 rounded transition-colors text-sm flex items-center justify-center gap-2">
              <i data-lucide="play" class="w-4 h-4"></i>
              Try it out
            </button>
          </div>
        </div>

        <!-- Endpoint 3: Webhook -->
        <div id="webhook" class="endpoint-card overflow-hidden">
          <div class="bg-zinc-900 border-b border-zinc-800 p-6">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center gap-3">
                <span class="method-badge method-post">POST</span>
                <code class="text-zinc-300 font-mono">/api/webhook</code>
              </div>
            </div>
            <p class="text-zinc-400 text-sm">Notificaciones de PayPal</p>
          </div>

          <div class="p-6 space-y-6">
            <div>
              <h3 class="text-sm font-semibold mb-3 text-zinc-300">Descripción</h3>
              <p class="text-zinc-400 text-sm leading-relaxed">
                Endpoint para recibir notificaciones de PayPal. Actualiza automáticamente el estado del pago en base a eventos de PayPal.
              </p>
            </div>

            <div class="border-b border-zinc-800">
              <div class="flex gap-4">
                <button class="tab-button active" onclick="switchTab(event, 'req3')">Request</button>
                <button class="tab-button" onclick="switchTab(event, 'res3')">Response</button>
              </div>
            </div>

            <div id="req3" class="space-y-4">
              <div>
                <h4 class="text-sm font-semibold text-zinc-300 mb-3">Eventos Soportados</h4>
                <div class="space-y-2">
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-3">
                    <div class="font-mono text-sm text-green-400">PAYMENT.CAPTURE.COMPLETED</div>
                    <p class="text-xs text-zinc-400 mt-1">Establece estado a COMPLETED</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-3">
                    <div class="font-mono text-sm text-red-400">PAYMENT.CAPTURE.DENIED</div>
                    <p class="text-xs text-zinc-400 mt-1">Establece estado a FAILED</p>
                  </div>
                  <div class="bg-zinc-900 border border-zinc-800 rounded p-3">
                    <div class="font-mono text-sm text-yellow-400">PAYMENT.CAPTURE.REFUNDED</div>
                    <p class="text-xs text-zinc-400 mt-1">Establece estado a REFUNDED</p>
                  </div>
                </div>
              </div>

              <div>
                <h4 class="text-sm font-semibold text-zinc-300 mb-3">Ejemplo: PAYMENT.CAPTURE.COMPLETED</h4>
                <div class="code-block">
<code>{
  "id": "WH-1A2B3C4D5E6F7G8H",
  "event_type": "PAYMENT.CAPTURE.COMPLETED",
  "create_time": "2024-10-22T15:30:45Z",
  "resource": {
    "id": "4VB83654HS123456",
    "status": "COMPLETED",
    "amount": {
      "currency_code": "MXN",
      "value": "1500.00"
    },
    "supplementary_data": {
      "related_ids": {
        "order_id": "44P80931C43019322"
      }
    },
    "payer": {
      "email_address": "buyer@example.com",
      "name": {
        "given_name": "John",
        "surname": "Doe"
      }
    }
  }
}</code>
                </div>
              </div>
            </div>

            <div id="res3" class="space-y-4 hidden">
              <div>
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-zinc-300">Webhook Recibido de PayPal</h4>
                  <div class="flex gap-2">
                    <button onclick="simularWebhook()" id="simularWebhookBtn" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                      <i data-lucide="send" class="w-4 h-4"></i>
                      Simular Webhook
                    </button>
                    <button onclick="copiarRespuesta('webhookResponse')" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                      <i data-lucide="copy" class="w-4 h-4"></i>
                      Copiar
                    </button>
                  </div>
                </div>
                <div id="webhookResponse" class="code-block text-xs overflow-auto max-h-96">
                  <code id="webhookResponseCode" class="text-yellow-400">Haz click en 'Simular Webhook' para ver un ejemplo...</code>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Endpoint 4: Health Check -->
        <div id="health" class="endpoint-card overflow-hidden">
          <div class="bg-zinc-900 border-b border-zinc-800 p-6">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center gap-3">
                <span class="method-badge method-get">GET</span>
                <code class="text-zinc-300 font-mono">/</code>
              </div>
            </div>
            <p class="text-zinc-400 text-sm">Verificación de salud del servicio</p>
          </div>

          <div class="p-6 space-y-6">
            <div>
              <h3 class="text-sm font-semibold mb-3 text-zinc-300">Descripción</h3>
              <p class="text-zinc-400 text-sm leading-relaxed">
                Retorna el estado del servicio y lista de endpoints disponibles. Útil para verificaciones de salud.
              </p>
            </div>

            <div class="border-b border-zinc-800">
              <div class="flex gap-4">
                <button class="tab-button active" onclick="switchTab(event, 'res4')">Response</button>
              </div>
            </div>

            <div id="res4" class="space-y-4">
              <div>
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-zinc-300">Response</h4>
                  <button onclick="copiarRespuesta('healthResponse')" class="text-zinc-400 hover:text-white transition-colors text-xs px-3 py-1 border border-zinc-700 rounded hover:border-zinc-500 flex items-center gap-2">
                    <i data-lucide="copy" class="w-4 h-4"></i>
                    Copiar
                  </button>
                </div>
                <div id="healthResponse" class="code-block text-xs overflow-auto max-h-96">
                  <code id="healthResponseCode" class="text-green-400">Aquí aparecerá el response...</code>
                </div>
              </div>
            </div>

            <button onclick="testHealthCheck()" class="w-full btn-blue text-white font-medium py-2 px-4 rounded transition-colors text-sm flex items-center justify-center gap-2">
              <i data-lucide="play" class="w-4 h-4"></i>
              Try it out
            </button>
          </div>
        </div>

        <!-- Footer -->
        <div class="border-t border-zinc-800 mt-12 pt-6 pb-6">
          <p class="text-zinc-500 text-sm">© 2024 UniqueMotors. All rights reserved.</p>
          <p class="text-zinc-600 text-xs mt-2">Last updated: October 2025</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Dock magnification effect
    function initDock() {
      const dock = document.getElementById('dock');
      const dockIcons = dock.querySelectorAll('.dock-icon');
      const DEFAULT_SIZE = 40;
      const DEFAULT_MAGNIFICATION = 60;
      const DEFAULT_DISTANCE = 140;

      let mouseX = Infinity;

      dock.addEventListener('mousemove', (e) => {
        mouseX = e.pageX;
        updateIconSizes();
      });

      dock.addEventListener('mouseleave', () => {
        mouseX = Infinity;
        updateIconSizes();
      });

      function updateIconSizes() {
        dockIcons.forEach((icon) => {
          const rect = icon.getBoundingClientRect();
          const iconCenterX = rect.left + rect.width / 2;
          const distance = Math.abs(mouseX - iconCenterX);

          let scale;
          if (distance < DEFAULT_DISTANCE) {
            const scaleFactor = 1 - distance / DEFAULT_DISTANCE;
            const sizeIncrease = (DEFAULT_MAGNIFICATION - DEFAULT_SIZE) * scaleFactor;
            const targetSize = DEFAULT_SIZE + sizeIncrease;
            scale = targetSize / DEFAULT_SIZE;
          } else {
            scale = 1;
          }

          icon.style.transform = `scale(${scale})`;
          icon.style.transition = 'transform 0.15s cubic-bezier(0.33, 1, 0.68, 1)';
        });
      }
    }

    // Scroll functions
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        updateActiveDockIcon(sectionId);
      }
    }

    function scrollToTop() {
      const mainContent = document.getElementById('mainContent');
      mainContent.scrollTo({ top: 0, behavior: 'smooth' });
      updateActiveDockIcon('top');
    }

    function updateActiveDockIcon(sectionId) {
      const dockIcons = document.querySelectorAll('.dock-icon');
      dockIcons.forEach(icon => {
        if (icon.dataset.section === sectionId) {
          icon.classList.add('active');
        } else {
          icon.classList.remove('active');
        }
      });
    }

    // Track active section on scroll
    function trackActiveSection() {
      const mainContent = document.getElementById('mainContent');
      const sections = ['create-order', 'capture-order', 'webhook', 'health'];

      mainContent.addEventListener('scroll', () => {
        if (mainContent.scrollTop < 100) {
          updateActiveDockIcon('top');
          return;
        }

        for (const sectionId of sections) {
          const section = document.getElementById(sectionId);
          if (section) {
            const rect = section.getBoundingClientRect();
            if (rect.top <= 200 && rect.bottom >= 200) {
              updateActiveDockIcon(sectionId);
              break;
            }
          }
        }
      });
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      initDock();
      trackActiveSection();
      updateActiveDockIcon('top');
    });

    // Tilt effect para Base URL card
    const baseUrlCard = document.getElementById('baseUrlCard');

    baseUrlCard.addEventListener('mousemove', (e) => {
      const rect = baseUrlCard.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const centerX = rect.width / 2;
      const centerY = rect.height / 2;

      const rotateX = (y - centerY) / 30;
      const rotateY = (centerX - x) / 30;

      baseUrlCard.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.01)`;
    });

    baseUrlCard.addEventListener('mouseleave', () => {
      baseUrlCard.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
    });

    baseUrlCard.style.transition = 'transform 0.2s ease-out';

    function switchTab(event, tabId) {
      event.preventDefault();
      const button = event.target.closest('.tab-button');
      const container = button.closest('.endpoint-card');

      // Hide all tabs in this container
      container.querySelectorAll('[id^="req"], [id^="res"]').forEach(el => {
        el.classList.add('hidden');
      });

      // Show selected tab
      document.getElementById(tabId).classList.remove('hidden');

      // Update button styles
      container.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      button.classList.add('active');
    }

    async function testCreateOrder() {
      const responseCode = document.getElementById('createOrderResponseCode');
      const baseUrl = 'https://unique-motors.onrender.com'; // CAMBIO TEMPORAL PARA TESTING
      const url = `${baseUrl}/api/orders`;

      try {
        // Show loading state
        responseCode.textContent = 'Cargando...';
        responseCode.className = 'text-yellow-400';

        // Switch to response tab
        const container = document.getElementById('create-order');
        container.querySelectorAll('[id^="req"], [id^="res"]').forEach(el => {
          el.classList.add('hidden');
        });
        document.getElementById('res1').classList.remove('hidden');

        // Update tab buttons
        container.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        const resButtons = container.querySelectorAll('.tab-button');
        if (resButtons.length > 1) {
          resButtons[1].classList.add('active');
        }

        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            amount: 10,
            currency: 'MXN'
          })
        };

        const response = await fetch(url, options);
        const data = await response.json();

        // Format the response
        let statusText = `Status: ${response.status} ${response.ok ? 'OK' : 'Error'}\n\n`;
        let formattedResponse = statusText + JSON.stringify(data, null, 2);

        responseCode.textContent = formattedResponse;
        responseCode.className = response.ok ? 'text-green-400' : 'text-red-400';

        // Show PayPal button if response has ID
        if (response.ok && data.id) {
          window.currentOrderID = data.id;
          document.getElementById('abrirPayPalBtn').classList.remove('hidden');
          document.getElementById('copiarIDBtn').classList.remove('hidden');
          lucide.createIcons();
        }
      } catch (error) {
        const errorMessage = `Error: ${error.message}\n\nAsegúrate de que el servidor esté corriendo en https://unique-motors.onrender.com`;
        responseCode.textContent = errorMessage;
        responseCode.className = 'text-red-400';
      }
    }

    function abrirPayPal() {
      if (window.currentOrderID) {
        // Abrir PayPal en nueva ventana (PRODUCCIÓN)
        window.open(`https://www.paypal.com/checkoutnow?token=${window.currentOrderID}`, '_blank');

        // Mostrar modal con el Order ID
        setTimeout(() => {
          mostrarModalOrderID();
        }, 500);
      }
    }

    function copiarSoloID() {
      if (window.currentOrderID) {
        navigator.clipboard.writeText(window.currentOrderID).then(() => {
          // Show success feedback
          const btn = document.getElementById('copiarIDBtn');
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Copiado!';
          btn.classList.add('text-green-400');
          btn.classList.remove('text-zinc-400');
          lucide.createIcons();
          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('text-green-400');
            btn.classList.add('text-zinc-400');
            lucide.createIcons();
          }, 2000);
        }).catch(() => {
          // Error silencioso
        });
      }
    }

    function mostrarWebhookReal(paymentRecord) {
      const webhookResponseCode = document.getElementById('webhookResponseCode');

      // Cambiar al tab de Response en Webhook
      const container = document.getElementById('webhook');
      container.querySelectorAll('[id^="req"], [id^="res"]').forEach(el => {
        el.classList.add('hidden');
      });
      document.getElementById('res3').classList.remove('hidden');

      // Update tab buttons
      container.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      const resButtons = container.querySelectorAll('.tab-button');
      if (resButtons.length > 1) {
        resButtons[1].classList.add('active');
      }

      // Simular el webhook con los datos reales
      const webhookReal = {
        id: "WH-REAL-" + Date.now(),
        event_type: "PAYMENT.CAPTURE.COMPLETED",
        create_time: new Date().toISOString(),
        resource: paymentRecord.paypal_response || paymentRecord,
        summary: "Webhook recibido de PayPal (datos reales)"
      };

      // Mostrar en el UI
      webhookResponseCode.textContent = `Webhook Recibido de PayPal\n\n` + JSON.stringify(webhookReal, null, 2);
      webhookResponseCode.className = 'text-green-400';

      // Scroll a la card de webhook
      container.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Feedback visual en el botón
      const btn = document.getElementById('simularWebhookBtn');
      if (btn) {
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Webhook PayPal';
        btn.classList.add('text-green-400');
        btn.classList.remove('text-zinc-400');
        lucide.createIcons();

        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.classList.remove('text-green-400');
          btn.classList.add('text-zinc-400');
          lucide.createIcons();
        }, 3000);
      }
    }

    function simularWebhook() {
      const webhookResponseCode = document.getElementById('webhookResponseCode');

      // Crear webhook simulado con datos reales de PayPal
      const webhookSimulado = {
        id: "WH-" + Math.random().toString(36).substr(2, 9).toUpperCase(),
        event_type: "PAYMENT.CAPTURE.COMPLETED",
        create_time: new Date().toISOString(),
        resource: {
          id: "CAPTURE-" + Math.random().toString(36).substr(2, 9).toUpperCase(),
          status: "COMPLETED",
          amount: {
            currency_code: "MXN",
            value: "100.00"
          },
          supplementary_data: {
            related_ids: {
              order_id: window.currentOrderID || "44P80931C43019322"
            }
          },
          payer: {
            email_address: "buyer@example.com",
            name: {
              given_name: "John",
              surname: "Doe"
            }
          }
        }
      };

      // Mostrar en el UI
      webhookResponseCode.textContent = JSON.stringify(webhookSimulado, null, 2);
      webhookResponseCode.className = 'text-green-400';

      // Feedback visual
      const btn = document.getElementById('simularWebhookBtn');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Simulado!';
      btn.classList.add('text-green-400');
      btn.classList.remove('text-zinc-400');
      lucide.createIcons();

      setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.classList.remove('text-green-400');
        btn.classList.add('text-zinc-400');
        lucide.createIcons();
      }, 2000);
    }

    async function testHealthCheck() {
      const responseCode = document.getElementById('healthResponseCode');
      const baseUrl = 'https://unique-motors.onrender.com'; // CAMBIO TEMPORAL PARA TESTING
      const url = `${baseUrl}/`;

      try {
        // Show loading state
        responseCode.textContent = 'Cargando...';
        responseCode.className = 'text-yellow-400';

        // Switch to response tab
        const container = document.getElementById('health');
        container.querySelectorAll('[id^="res"]').forEach(el => {
          el.classList.add('hidden');
        });
        document.getElementById('res4').classList.remove('hidden');

        const options = {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        };

        const response = await fetch(url, options);
        const data = await response.json();

        // Format the response
        let statusText = `Status: ${response.status} ${response.ok ? 'OK' : 'Error'}\n\n`;
        let formattedResponse = statusText + JSON.stringify(data, null, 2);

        responseCode.textContent = formattedResponse;
        responseCode.className = response.ok ? 'text-green-400' : 'text-red-400';
      } catch (error) {
        const errorMessage = `Error: ${error.message}\n\nAsegúrate de que el servidor esté corriendo en https://unique-motors.onrender.com`;
        responseCode.textContent = errorMessage;
        responseCode.className = 'text-red-400';
      }
    }

    async function captureOrder() {
      const orderID = document.getElementById('captureOrderID').value.trim();
      const responseCode = document.getElementById('captureResponseCode');

      if (!orderID) {
        responseCode.textContent = 'Error: Por favor ingresa un Order ID válido';
        responseCode.className = 'text-red-400';

        // Switch to response tab
        const container = document.getElementById('capture-order');
        container.querySelectorAll('[id^="req"], [id^="res"]').forEach(el => {
          el.classList.add('hidden');
        });
        document.getElementById('res2').classList.remove('hidden');

        // Update tab buttons
        container.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        const resButtons = container.querySelectorAll('.tab-button');
        if (resButtons.length > 1) {
          resButtons[1].classList.add('active');
        }
        return;
      }

      const baseUrl = 'https://unique-motors.onrender.com'; // CAMBIO TEMPORAL PARA TESTING
      const url = `${baseUrl}/api/orders/${orderID}/capture`;

      try {
        // Show loading state
        responseCode.textContent = 'Cargando... esperando respuesta de PayPal';
        responseCode.className = 'text-yellow-400';

        // Switch to response tab
        const container = document.getElementById('capture-order');
        container.querySelectorAll('[id^="req"], [id^="res"]').forEach(el => {
          el.classList.add('hidden');
        });
        document.getElementById('res2').classList.remove('hidden');

        // Update tab buttons
        container.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        const resButtons = container.querySelectorAll('.tab-button');
        if (resButtons.length > 1) {
          resButtons[1].classList.add('active');
        }

        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({})
        };

        const response = await fetch(url, options);
        const data = await response.json();

        // Format the response
        let statusText = `Status: ${response.status} ${response.ok ? 'OK' : 'Error'}\n\n`;
        let formattedResponse = statusText + JSON.stringify(data, null, 2);

        responseCode.textContent = formattedResponse;
        responseCode.className = response.ok ? 'text-green-400' : 'text-red-400';


        // Si el webhook fue recibido, mostrarlo automáticamente en la card de Webhook
        if (response.ok && data.webhookReceived === true) {
          responseCode.textContent += `\n\nWebhook recibido de PayPal (esperó ${data.waitTime})`;

          // Mostrar el webhook en la card de Webhook automáticamente
          setTimeout(() => {
            mostrarWebhookReal(data.paymentRecord);
          }, 1000);
        } else if (response.ok && data.webhookReceived === false) {
          responseCode.textContent += `\n\nWebhook no recibido en ${data.waitTime} (timeout)`;
        } else {
        }
      } catch (error) {
        const errorMessage = `Error: ${error.message}\n\nAsegúrate de que el servidor esté corriendo en https://unique-motors.onrender.com`;
        responseCode.textContent = errorMessage;
        responseCode.className = 'text-red-400';
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Silent copy - sin alert
      }).catch(() => {
        // Silent fail - sin alert
      });
    }

    function copiarRespuesta(elementId) {
      const element = document.getElementById(elementId);
      const respuesta = element.querySelector('code').textContent;

      if (respuesta && respuesta !== 'Aquí aparecerá el response...' && respuesta !== 'Cargando...') {
        navigator.clipboard.writeText(respuesta).then(() => {
          // Show success feedback
          const btn = event.target.closest('button');
          const originalText = btn.textContent;
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Copiado!';
          btn.classList.add('text-green-400');
          btn.classList.remove('text-zinc-400');
          lucide.createIcons();
          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('text-green-400');
            btn.classList.add('text-zinc-400');
            lucide.createIcons();
          }, 2000);
        }).catch(() => {
          // Error silencioso
        });
      }
    }

    async function pegarOrderID() {
      try {
        const text = await navigator.clipboard.readText();
        const input = document.getElementById('captureOrderID');
        input.value = text;

        // Show feedback
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
        btn.classList.add('text-green-400');
        btn.classList.remove('text-zinc-400');
        lucide.createIcons();

        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.classList.remove('text-green-400');
          btn.classList.add('text-zinc-400');
          lucide.createIcons();
        }, 2000);
      } catch (err) {
        // Error silencioso
      }
    }

    // Modal functions
    function mostrarModalOrderID() {
      const modal = document.getElementById('modalOrderID');
      const input = document.getElementById('modalOrderIDInput');

      if (window.currentOrderID) {
        input.value = window.currentOrderID;
      }

      modal.classList.add('active');

      // Inicializar iconos de Lucide en el modal
      lucide.createIcons();

      // Focus en el input después de que se muestre el modal
      setTimeout(() => {
        input.focus();
        input.select();
      }, 100);
    }

    function cerrarModal() {
      const modal = document.getElementById('modalOrderID');
      modal.classList.remove('active');
    }

    function pegarEnCapture() {
      const modalInput = document.getElementById('modalOrderIDInput');
      const captureInput = document.getElementById('captureOrderID');

      if (modalInput.value.trim()) {
        captureInput.value = modalInput.value.trim();

        // Copiar al clipboard también
        navigator.clipboard.writeText(modalInput.value.trim());

        // Cerrar modal
        cerrarModal();

        // Scroll al endpoint de capture
        document.getElementById('capture-order').scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Flash en el input de capture
        captureInput.classList.add('ring-2');
        captureInput.style.setProperty('--tw-ring-color', 'var(--color-blue)');
        setTimeout(() => {
          captureInput.classList.remove('ring-2');
        }, 2000);
      }
    }

    // Cerrar modal al hacer click fuera
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('modalOrderID');
      if (e.target === modal) {
        cerrarModal();
      }
    });

    // Cerrar modal con tecla Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        cerrarModal();
      }
    });

    // Detectar si regresamos de PayPal y mostrar modal automáticamente
    window.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const PayerID = urlParams.get('PayerID');

      // Si hay token y PayerID, significa que regresamos de PayPal
      if (token && PayerID) {
        // Guardar el Order ID
        window.currentOrderID = token;

        // Mostrar el modal automáticamente
        setTimeout(() => {
          mostrarModalOrderID();
        }, 500);

        // Limpiar la URL para que no se vea feo
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });
  </script>

  <!-- Modal Order ID -->
  <div id="modalOrderID" class="modal-overlay">
    <div class="modal-content">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <i data-lucide="check-circle-2" class="w-5 h-5 text-green-400"></i>
          <h3 class="text-lg font-semibold text-white">Order ID Generado</h3>
        </div>
        <button onclick="cerrarModal()" class="text-zinc-400 hover:text-white transition-colors">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <p class="text-sm text-zinc-400 mb-4">
        Ya puedes pegar el Order ID en el siguiente input para capturar la orden.
      </p>

      <div class="space-y-4">
        <div>
          <label for="modalOrderIDInput" class="block text-sm font-medium text-zinc-300 mb-2">
            Order ID
          </label>
          <input
            type="text"
            id="modalOrderIDInput"
            class="modal-input font-mono"
            readonly
            placeholder="Generando Order ID..."
          />
          <p class="text-xs text-zinc-500 mt-2 flex items-center gap-1">
            <i data-lucide="info" class="w-3 h-3"></i>
            Este ID se copiará automáticamente al siguiente input
          </p>
        </div>

        <div class="flex gap-3">
          <button
            onclick="pegarEnCapture()"
            class="flex-1 btn-blue text-white font-medium py-2.5 px-4 rounded-md transition-colors text-sm flex items-center justify-center gap-2 hover:bg-opacity-90"
          >
            <i data-lucide="arrow-down-to-line" class="w-4 h-4"></i>
            Pegar en Capture Order
          </button>
          <button
            onclick="cerrarModal()"
            class="px-4 py-2.5 bg-zinc-800 hover:bg-zinc-700 text-white font-medium rounded-md transition-colors text-sm"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
